%!TEX root = Main.tex
\documentclass[Main]{subfiles}

\begin{document}

\section{Hardware} % (fold)
\label{sec:hardware}

	\subsection{Platform} % (fold)
	\label{sub:platform}

		The processing platform chosen for this project is a \emph{ZYBO Zynqâ„¢-7000 Development Board} from Digilent (see Figure \ref{fig:ZYBO}).
		The brains of the ZYBO is a Xilinx Zynq-7000 All Programmable System on a Chip (AP SoC).
		The AP SoC (see Figure \ref{fig:ZynqArch}) features both a Processing System (PS) consisting of 650 MHz dual core ARM\textregistered{} Cortex A9 CPU with dedicated I/O and Memory and extensible FPGA Programmable Logic (PL) for HW synthesis.

		This enables the construction of a system with software, written in C++, running on the CPU, and with dedicated hardware for acceleration of computation and I/O handling.
		\begin{figure}[H]
			\centering
			\begin{subfigure}[b]{0.55\linewidth}
				\includegraphics[width=\linewidth]{ZYBO}
				\caption{Digilent Zynq Board (ZYBO)}
				\label{fig:ZYBO}
			\end{subfigure}		
			\begin{subfigure}[b]{0.4\linewidth}
				\includegraphics[width=\linewidth]{ZynqArch}
				\caption{Zynq-7000 AP SoC Diagram}
				\label{fig:ZynqArch}
			\end{subfigure}
			\caption{Figures borrowed from \cite{Digilent2014}}		
		\end{figure}

		Alongside the AP SoC the ZYBO features a range external hardware for power supply/management and interfacing.
		It has push-buttons, throw-switches and LEDs for direct interface, USB-OTG, UART-to-USB and Ethernet for communication and HDMI, VGA and an audio codec for Audio/Visual.

		Lastly, the ZYBO features six PMOD GPIO ports along the perimeter (see Figure \ref{fig:ZYBO}), one directly connected to the PS and the others accessible through the PL.
		They deliver 3.3V power to external devices as well as eight customizable 1.8V or 3.3V digital I/O ports each (see Figure \ref{fig:pmod}).
		These are used for interfacing with the sensor and motor (see Section \fxnote{ref to sensors} and \fxnote{ref to mortors}, respectively).

		\begin{figure}[H]
			\centering
			\includegraphics[width=0.5\linewidth]{PMOD_connector}
			\caption{PMOD Connector. Borrowed from \cite{Digilent2014}}
			\label{fig:pmod}
		\end{figure}


		\subsubsection{HW/SW Co-Design} % (fold)
		\label{ssub:hw_sw_co_design}

			The availability of FPGA logic on-chip enables rapid prototyping of HW acceleration blocks, through the use of High-Level Synthesis (HLS) tools.
			Using HLS one can specify some desired functionality in C++/SystemC code and directly synthesize it to HW-blocks to be implemented in FPGA logic, without needing to explicitly design HW in a Hardware Description Language like VHDL or Verilog.

			This is utilized for creating a PWM motor controller, described in Section \fxnote{ref to PWM controller HLS}.

			% subsubsection hw_sw_co_design (end)
	
		% subsection platform (end)

	\subsection{Power} % (fold)
	\label{sub:power}
	
	% subsection power (end)

	\subsection{Sensors} % (fold)
	\label{sub:sensor}
	
	% subsection sensor (end)

	\subsection{Motor Control} % (fold)
	\label{sub:motor_control}

		The motor control hardware consists of two major blocks, an external Dual H-Bridge for driving the power the the motors, and an on-chip PWM controller for controlling the motor driver.

		\subsubsection{External Dual H-Bridge} % (fold)
		\label{ssub:external_dual_h_bridge}
			
			The \emph{DHB1} from Digilent in a dual- H-bridge motor controller that enables regular DC-motors to be driven in either direction with with a single ended power supply.
			Further it provides logic level transistor switching so that higher voltages (up to 11.8V) and higher currents (1.5A RMS, 2A peak) can be used to drive the motor without loading the logic circuit.

			\begin{figure}[H]
				\centering
				\includegraphics[width=0.5\linewidth]{PmodDHB1}
				\caption{Digilent PmodPHB1 Dual H-Bridge Motor controller \cite{Digilent2014}}
				\label{fig:DHB1}
			\end{figure}

			The DHB1 connects to the ZYBO via a PMOD connector. The individual signals signal are listed in \autoref{tab:dhb_pmod}.
			The motor power source is connected to the DHB1 with screw terminals. The two motors are also connected with screw terminals, but the left motor is connected reversed polarity.
			This is because the identical motors need to spin in different directions to achieve the same rotation in relation to the direction of travel.

			\begin{table}[H]
				\centering
				\begin{subtable}[b]{0.6\linewidth}
					\begin{tabular}{|c|l|l|}
						\hline
						{\bf Pin} & {\bf Signal} & {\bf Description}         \\ \hline
						1         & EN1          & Motor 1 Enable            \\ \hline
						2         & DIR1         & Motor 1 Direction         \\ \hline
						3         & S1A          & Motor 1 Sensor A Feedback \\ \hline
						4         & S1B          & Motor 1 Sensor B Feedback \\ \hline
						5         & GND          & Power Supply Ground       \\ \hline
						6         & $V_{CC}$     & Power Supply (3.3V)       \\ \hline
						7         & EN2          & Motor 2 Enable            \\ \hline
						8         & DIR2         & Motor 2 Direction         \\ \hline
						9         & S2A          & Motor 2 Sensor A Feedback \\ \hline
						10        & S2B          & Motor 2 Sensor B Feedback \\ \hline
						11        & GND          & Power Supply Ground       \\ \hline
						12        & $V_{CC}$   & Power Supply (3.3V)       \\ \hline
					\end{tabular}
					\caption{PMOD connection description}
					\label{tab:dhb_pmod}
				\end{subtable}
				\begin{subtable}[b]{0.3\linewidth}
					\centering
					\begin{tabular}{ccl}
						\hline
						\multicolumn{1}{|c|}{{\bf DIR1}} & \multicolumn{1}{c|}{{\bf EN1}} & \multicolumn{1}{l|}{{\bf Result M1}} \\ \hline
						\multicolumn{1}{|c|}{0}          & \multicolumn{1}{c|}{0}         & \multicolumn{1}{l|}{Stop}            \\ \hline
						\multicolumn{1}{|c|}{0}          & \multicolumn{1}{c|}{1/PWM}     & \multicolumn{1}{l|}{Forward}         \\ \hline
						\multicolumn{1}{|c|}{1}          & \multicolumn{1}{c|}{0}         & \multicolumn{1}{l|}{Stop}            \\ \hline
						\multicolumn{1}{|c|}{1}          & \multicolumn{1}{c|}{1/PWM}     & \multicolumn{1}{l|}{Reverse}         \\ \hline
						                                 &                                &                                      \\ \hline
						\multicolumn{1}{|c|}{{\bf DIR2}} & \multicolumn{1}{c|}{{\bf EN2}} & \multicolumn{1}{l|}{{\bf Result M2}} \\ \hline
						\multicolumn{1}{|c|}{0}          & \multicolumn{1}{c|}{0}         & \multicolumn{1}{l|}{Stop}            \\ \hline
						\multicolumn{1}{|c|}{0}          & \multicolumn{1}{c|}{1/PWM}     & \multicolumn{1}{l|}{Forward}         \\ \hline
						\multicolumn{1}{|c|}{1}          & \multicolumn{1}{c|}{0}         & \multicolumn{1}{l|}{Stop}            \\ \hline
						\multicolumn{1}{|c|}{1}          & \multicolumn{1}{c|}{1/PWM}     & \multicolumn{1}{l|}{Reverse}         \\ \hline
					\end{tabular}
					\caption{Truth table for DHB-1 input}
					\label{tab:motor_signal}
				\end{subtable}
				\caption{} 
			\end{table} 

			To control the direction of the motor one applies a logic level to the \emph{DIR} pin for the corresponding motor; 1 for forward, 0 for reverse.
			The speed of the motors are controlled by applying a Pulse Width Modulated (PWM) signal to the EN pin for the corresponding motor (see \autoref{tab:motor_signal}).
			The sensor feedback pins are not used as there are no sensors attached to the wheels.

			For more information, see the reference manual \cite{Digilent2014}.

			% subsubsection external_dual_h_bridge (end)
		
		% subsection motor_control (end)

	% section hardware (end)

\end{document}